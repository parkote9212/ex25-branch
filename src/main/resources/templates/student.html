<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>학생 관리 시스템</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        .container { max-width: 800px; margin: auto; }
        h1, h2 { text-align: center; }
        form { margin-bottom: 2em; padding: 1em; border: 1px solid #ccc; border-radius: 5px; }
        form div { margin-bottom: 1em; }
        label { display: inline-block; width: 80px; }
        input[type="text"], input[type="email"], input[type="number"] { width: calc(100% - 100px); padding: 8px; }
        button { padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-save { background-color: #007bff; color: white; }
        .btn-new { background-color: #6c757d; color: white; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .actions button { margin-right: 5px; }
        .btn-edit { background-color: #ffc107; }
        .btn-delete { background-color: #dc3545; color: white; }
    </style>
</head>
<body>

<div class="container">
    <h1>학생 관리 시스템</h1>

    <h2>학생 정보 입력</h2>
    <form id="student-form">
        <input type="hidden" id="student-id">
        <div>
            <label for="name">이름:</label>
            <input type="text" id="name" required>
        </div>
        <div>
            <label for="email">이메일:</label>
            <input type="email" id="email" required>
        </div>
        <div>
            <label for="age">나이:</label>
            <input type="number" id="age" required>
        </div>
        <button type="submit" class="btn-save">저장</button>
        <button type="button" id="btn-new-form" class="btn-new">새로 작성</button>
    </form>

    <h2>학생 목록</h2>
    <table id="student-table">
        <thead>
        <tr>
            <th>ID</th>
            <th>이름</th>
            <th>이메일</th>
            <th>나이</th>
            <th>관리</th>
        </tr>
        </thead>
        <tbody id="student-list">
        </tbody>
    </table>
</div>

<script>
    const studentForm = document.getElementById('student-form');
    const studentIdField = document.getElementById('student-id');
    const nameField = document.getElementById('name');
    const emailField = document.getElementById('email');
    const ageField = document.getElementById('age');
    const studentList = document.getElementById('student-list');
    const newFormButton = document.getElementById('btn-new-form');

    const API_URL = '/students';

    // 모든 학생 목록을 가져와 테이블에 렌더링하는 함수
    async function fetchStudents() {
        try {
            const response = await fetch(API_URL);
            const students = await response.json();

            studentList.innerHTML = ''; // 기존 목록 초기화
            students.forEach(student => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${student.id}</td>
                    <td>${student.name}</td>
                    <td>${student.email}</td>
                    <td>${student.age}</td>
                    <td class="actions">
                        <button class="btn-edit" onclick="editStudent(${student.id}, '${student.name}', '${student.email}', ${student.age})">수정</button>
                        <button class="btn-delete" onclick="deleteStudent(${student.id})">삭제</button>
                    </td>
                `;
                studentList.appendChild(row);
            });
        } catch (error) {
            console.error('학생 목록을 불러오는 중 오류 발생:', error);
        }
    }

    // 학생 정보 저장 (생성 또는 수정)
    studentForm.addEventListener('submit', async (event) => {
        event.preventDefault(); // 폼 기본 제출 동작 방지

        const studentData = {
            name: nameField.value,
            email: emailField.value,
            age: parseInt(ageField.value, 10)
        };

        const studentId = studentIdField.value;
        const method = studentId ? 'PUT' : 'POST'; // ID 유무에 따라 메소드 결정
        const url = studentId ? `${API_URL}/${studentId}` : API_URL;

        try {
            const response = await fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(studentData),
            });

            if (response.ok) {
                resetForm();
                await fetchStudents(); // 목록 새로고침
            } else {
                console.error('저장 실패:', await response.text());
            }
        } catch (error) {
            console.error('저장 중 오류 발생:', error);
        }
    });

    // 수정 버튼 클릭 시 폼에 데이터 채우기
    function editStudent(id, name, email, age) {
        studentIdField.value = id;
        nameField.value = name;
        emailField.value = email;
        ageField.value = age;
        window.scrollTo(0, 0); // 페이지 상단으로 스크롤
    }

    // 삭제 버튼 클릭 시 학생 삭제
    async function deleteStudent(id) {
        if (!confirm(`ID ${id} 학생을 정말 삭제하시겠습니까?`)) {
            return;
        }

        try {
            const response = await fetch(`${API_URL}/${id}`, {
                method: 'DELETE',
            });

            if (response.ok) {
                await fetchStudents(); // 목록 새로고침
            } else {
                console.error('삭제 실패:', await response.text());
            }
        } catch (error) {
            console.error('삭제 중 오류 발생:', error);
        }
    }

    // 폼 초기화
    function resetForm() {
        studentForm.reset();
        studentIdField.value = '';
    }

    // '새로 작성' 버튼 이벤트 리스너
    newFormButton.addEventListener('click', resetForm);

    // 페이지 로드 시 학생 목록을 불러옴
    document.addEventListener('DOMContentLoaded', fetchStudents);
</script>

</body>
</html>